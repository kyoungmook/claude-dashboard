<!-- Tool Usage Bar Chart -->
<div class="bg-gray-800 rounded-lg p-6 border border-gray-700 mb-8">
  <h2 class="text-lg font-semibold mb-4">도구 사용 빈도</h2>
  <div class="chart-container" style="height: 400px;">
    <canvas id="toolUsageChart"></canvas>
  </div>
</div>

<!-- Tool Stats Table -->
<div class="bg-gray-800 rounded-lg p-6 border border-gray-700 mb-8">
  <h2 class="text-lg font-semibold mb-4">도구 통계</h2>
  <div class="overflow-x-auto">
    <table class="w-full text-sm">
      <thead>
        <tr class="text-gray-400 border-b border-gray-700">
          <th class="text-left py-3 px-4">도구</th>
          <th class="text-right py-3 px-4">총 호출</th>
          <th class="text-right py-3 px-4">사용 세션</th>
          <th class="text-right py-3 px-4">세션당 평균</th>
        </tr>
      </thead>
      <tbody>
        {% for t in tool_stats %}
        <tr class="border-b border-gray-700/50 hover:bg-gray-700/30">
          <td class="py-3 px-4 font-medium text-purple-400">{{ t.name }}</td>
          <td class="py-3 px-4 text-right text-gray-300">{{ "{:,}".format(t.call_count) }}</td>
          <td class="py-3 px-4 text-right text-gray-300">{{ t.session_count }}</td>
          <td class="py-3 px-4 text-right text-gray-300">{{ t.avg_per_session }}</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>

<!-- Recent Tool Usage by Session -->
<div class="bg-gray-800 rounded-lg p-6 border border-gray-700 mb-4">
  <h2 class="text-lg font-semibold mb-4">최근 세션별 도구 사용</h2>
  <div class="space-y-2">
    {% for s in tool_by_session %}
    <a href="/sessions/{{ s.session_id }}"
       class="flex items-center justify-between p-3 bg-gray-700/30 rounded-lg hover:bg-gray-700/50 transition-colors">
      <div>
        <span class="text-sm font-medium text-blue-400">{{ s.project_name }}</span>
        <span class="text-xs text-gray-400 ml-2">{{ s.date }}</span>
      </div>
      <span class="text-sm text-purple-400 font-semibold">{{ s.tool_calls_count }}회 호출</span>
    </a>
    {% endfor %}
  </div>
</div>

<div class="text-right text-xs text-gray-500">갱신: {{ updated_at }}</div>

<script>
  (function() {
    const toolData = {{ tool_stats | tojson }};
    const top20 = toolData.slice(0, 20);

    createHorizontalBarChart('toolUsageChart', {
      labels: top20.map(d => d.name),
      datasets: [{
        label: '호출 횟수',
        data: top20.map(d => d.call_count),
        backgroundColor: '#a855f7',
        borderRadius: 4,
      }],
    });
  })();
</script>
